{{define "solid-microapps"}}
<!DOCTYPE html>
<html lang="en" color-scheme="auto">
{{template "head" .}}
<body>
  <main class="flow">
    <div class="wrapper flow prose">
      <h1>Javascript micro-apps</h1>
      <section>
        <h2>Vanilla app</h2>
        <div id="vanilla"></div>
      </section>
    </div>
  </main>
  {{template "wsreload" .}}

  <script type="module">

    var handler = function (instance) {
      return {
        get: function (obj, prop) {
          if (["[object Object]", "[object Array]"].indexOf(Object.prototype.toString.call(obj[prop])) > -1) {
            return new Proxy(obj[prop], handler(instance));
          }
          return obj[prop];
          //instance.render(); // removed based on being after the return statement
        },
        set: function (obj, prop, value) {
          obj[prop] = value;
          instance.render();
          return true;
        },
        deleteProperty: function (obj, prop) {
          delete obj[prop];
          instance.render();
          return true;
    
        }
      };
    };
    
    var App = function (options) {
      // Variables
      var _this = this;
      _this.elem = document.querySelector(options.selector);
      var _data = new Proxy(options.data, handler(this));
      _this.template = options.template;
    
      // Define setter and getter for data
      Object.defineProperty(this, "data", {
        get: function () {
          return _data;
        },
        set: function (data) {
          _data = new Proxy(data, handler(_this));
          _this.render();
          
          return true;
        }
      });
    };
    
    App.prototype.render = function () {
      this.elem.innerHTML = this.template(this.data);
    };
    
    var app = new App({
      selector: "#vanilla",
      data: ["Swim", "Climb", "Jump", "Play"],
      template: function (props) {
        return `
          <h3>My TODOs</h3>
          <ul>
            ${props.map(function (todo) {
              return `<li>${todo}</li>`;
            }).join("")}
          </ul>`;
      }
    });
    
    // Render the initial UI
    app.render();
    
    // After 3 seconds, update the data and render a new UI
    setTimeout(function () {
      app.data.push("Take a nap... zzzzz");
    }, 3000);


  </script>
</body>
</html>
{{end}}